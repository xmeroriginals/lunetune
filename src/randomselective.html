<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Lunetune Selective</title>
</head>
<body>
  <script>
    const query = window.location.search.substring(1);
    const params = query.split("&").map(Number);

    function sendJson(obj) {
      const json = JSON.stringify(obj);
      const pre = document.createElement("pre");
      pre.textContent = json;
      document.body.innerHTML = "";
      document.body.appendChild(pre);
      window.parent.postMessage({
        type: 'iframeContent',
        uid: window.uid || null,
        content: json
      }, '*');
    }

    if (params.length !== 3 || params.some(isNaN)) {
      sendJson({ error: "Invalid" });
    } else {
      const [start, end, exclude] = params;
      const validNumbers = [];

      for (let i = start; i <= end; i++) {
        if (i !== exclude) {
          validNumbers.push(i);
        }
      }

      if (validNumbers.length === 0) {
        sendJson({ error: "Error" });
      } else {
        const selected = validNumbers[Math.floor(Math.random() * validNumbers.length)];
        sendJson({ selected });
      }
    }
    window.addEventListener('message', (event) => {
      if (event.data?.type === 'requestContent') {
        window.uid = event.data.uid;
      }
    });
  </script>
</body>
</html>
